openapi: 3.0.4

info:
  title: Storey
  version: 1.0.0
  description: >
    Save your money by buying the most budget-friendly products between multiple
    options, and plan your shopping beforehand.

paths:
  ### ======================== Products ======================== ###

  /products:
    get:
      summary: Get a list of products.
      tags:
        - Product
      parameters:
        - $ref: '#/components/parameters/pageParam'
        - $ref: '#/components/parameters/limitParam'
        - $ref: '#/components/parameters/sortParam'
      responses:
        '200':
          description: Returns a list of products.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/ResponseStatus'
                  data:
                    $ref: '#/components/schemas/ProductListWithPageResponse'
    post:
      summary: Create a new product.
      tags:
        - Product
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProductInput'
      responses:
        '201':
          description: Returns the newly created product.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/ResponseStatus'
                  data:
                    $ref: '#/components/schemas/Product'

  /products/{id}:
    parameters:
      - $ref: '#/components/parameters/idParam'

    get:
      summary: Get a product details.
      tags:
        - Product
      responses:
        '200':
          description: Returns a product details based on given product ID.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/ResponseStatus'
                  data:
                    $ref: '#/components/schemas/Product'
    patch:
      summary: Edit a product details.
      tags:
        - Product
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EditProductInput'
      responses:
        '200':
          description: Returns the edited product.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/ResponseStatus'
                  data:
                    $ref: '#/components/schemas/Product'
    delete:
      summary: Delete a product.
      tags:
        - Product
      responses:
        '200':
          description: Returns the deleted product.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/ResponseStatus'
                  data:
                    $ref: '#/components/schemas/Product'

  /products/{id}/price:
    patch:
      summary: Change product price.
      tags:
        - Product
      parameters:
        - $ref: '#/components/parameters/idParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                price:
                  type: number
      responses:
        '200':
          description: Returns the product's new pricing information.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/ResponseStatus'
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                      price:
                        type: number
                      pricePerUnit:
                        type: number
                        format: float
                    example:
                      _id: 507f1f77bcf86cd799439011
                      price: 3000
                      netto: 80.00
                      unit: g
                      pricePerUnit: 37.50

  ### ======================== Notes ======================== ###

  /notes:
    get:
      summary: Get a list of notes.
      tags:
        - Notes
      parameters:
        - $ref: '#/components/parameters/pageParam'
        - $ref: '#/components/parameters/limitParam'
        - $ref: '#/components/parameters/sortParam'
      responses:
        '200':
          description: Successful notes fetch. Returns a list of notes with pagination information.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/ResponseStatus'
                  data:
                    $ref: '#/components/schemas/NoteListWithPageResponse'

  ### ======================== Images ======================== ###

  /image:
    post:
      summary: Upload new images to cloud storage.
      tags:
        - Image
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                images:
                  type: array
                  description: 'Array of image files. Supported formats: PNG, JPEG, WebP. Maximum 5 files per request.'
                  items:
                    type: string
                    format: binary
                  minItems: 1
                  maxItems: 5
            encoding:
              images:
                contentType: image/png, image/jpeg, image/webp
      responses:
        '200':
          description: Successful image upload. Returns an array of uploaded images public ID and URL.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/ResponseStatus'
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Image'
    delete:
      summary: Delete images from cloud storage.
      tags:
        - Image
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/Image'
              description: An array of images that are about to be deleted.
      responses:
        '204':
          description: Successful image deletion.

  ### ======================== User ======================== ###

  /user/register:
    post:
      summary: Register a new user.
      tags:
        - User
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegisterInput'
      responses:
        '200':
          description: Successful user registration. Returns basic user information and establish a login session.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/ResponseStatus'
                  data:
                    type: object
                    properties:
                      username:
                        type: string
                    example:
                      username: JohnDoe

  /user/login:
    post:
      summary: User login.
      tags:
        - User
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLoginInput'
      responses:
        '200':
          description: Successful user login. Returns basic user information and establish a login session.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/ResponseStatus'
                  data:
                    type: object
                    properties:
                      username:
                        type: string
                    example:
                      username: JohnDoe

  /user/logout:
    get:
      summary: User logout.
      tags:
        - User
      responses:
        '204':
          description: Successful user logout.

  /user/categories:
    post:
      summary: Create a new category to user's category list.
      tags:
        - User
        - Category
      requestBody:
        content:
          text/plain:
            example: food
      responses:
        '201':
          description: Successful category creation.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/ResponseStatus'
                  data:
                    $ref: '#/components/schemas/Category'

  /user/categories/{id}:
    parameters:
      - $ref: '#/components/parameters/idParam'

    patch:
      summary: Change category data and apply it to all products.
      tags:
        - User
        - Category
      requestBody:
        content:
          text/plain:
            example: food
      responses:
        '204':
          description: Successful category name change.
    delete:
      summary: Delete a category and remove it from all products.
      tags:
        - User
        - Category
      responses:
        '204':
          description: Successful category deletion.

  /user/unit:
    post:
      summary: Create a new unit measurement.
      tags:
        - User
        - Unit Measurement
      requestBody:
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/UnitInput'
                - required:
                    - name
                    - abbreviation
      responses:
        '201':
          description: Successful unit creation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Unit'

  /user/unit/{id}:
    parameters:
      - $ref: '#/components/parameters/idParam'

    patch:
      summary: Change unit measurement data and apply it to all products.
      tags:
        - User
        - Unit Measurement
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UnitInput'
      responses:
        '200':
          description: Successful unit measurement changes.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/ResponseStatus'
                  data:
                    $ref: '#/components/schemas/Unit'
    delete:
      summary: Delete unit measurement and remove it from all products.
      tags:
        - User
        - Unit Measurement
      responses:
        '204':
          description: Successful unit measurement deletion.

  /user/store:
    post:
      summary: Create a new store data.
      tags:
        - User
        - Store
      requestBody:
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/StoreInput'
                - required:
                    - name
      responses:
        '201':
          description: Successful store creation.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/ResponseStatus'
                  data:
                    $ref: '#/components/schemas/Store'

  /user/store/{id}:
    parameters:
      - $ref: '#/components/parameters/idParam'

    patch:
      summary: Change store data and apply it to all products.
      tags:
        - User
        - Store
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StoreInput'
      responses:
        '200':
          description: Successful store data changes.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    $ref: '#/components/schemas/ResponseStatus'
                  data:
                    $ref: '#/components/schemas/Store'
    delete:
      summary: Delete a store data and remove it from all products.
      tags:
        - User
        - Store
      responses:
        '204':
          description: Successful store deletion.

components:
  schemas:
    ### ======================== Product ======================== ###

    Product:
      type: object
      properties:
        _id:
          type: string
        name:
          type: string
        description:
          type: string
        images:
          type: array
          items:
            $ref: '#/components/schemas/Image'
        categories:
          $ref: '#/components/schemas/Categories'
        price:
          type: number
        netto:
          type: number
          format: float
        unit:
          $ref: '#/components/schemas/Unit'
        pricePerUnit:
          type: number
          format: float
        store:
          $ref: '#/components/schemas/Store'
        pinned:
          type: boolean
          default: false
        author:
          $ref: '#/components/schemas/User'
        createdAt:
          type: string
          format: date-time
      example:
        _id: 507f1f77bcf86cd799439011
        name: Indomie Goreng
        description: The best instant fried noodle in Indonesia.
        images:
          - publicId: public_id
            url: https://photo.com/path-to-image.png
        categories:
          - _id: 507f1f77bcf86cd799439011
            name: food
        price: 3000
        netto: 80.00
        unit:
          _id: 507f1f77bcf86cd799439011
          name: gram
          abbreviation: g
        pricePerUnit: 37.50
        store:
          _id: 507f1f77bcf86cd799439011
          name: Indomaret Nglegok
          address: Jl. Raya Penataran, Nglegok 1, Nglegok, Kec. Nglegok, Kabupaten Blitar, Jawa Timur
        pinned: true,
        author:
          username: 'JohnDoe'
        createdAt: 2025-09-12T03:57:00.600Z
    ProductInputBase:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        images:
          type: array
          items:
            $ref: '#/components/schemas/Image'
        categories:
          $ref: '#/components/schemas/Categories'
        price:
          type: number
        netto:
          type: number
          format: float
        unit:
          $ref: '#/components/schemas/Unit'
        pricePerUnit:
          type: number
          format: float
        store:
          $ref: '#/components/schemas/Store'
    CreateProductInput:
      allOf:
        - $ref: '#/components/schemas/ProductInputBase'
        - required:
            - name
            - price
            - netto
            - unit
            - pricePerUnit
          example:
            name: Indomie Goreng
            description: The best instant fried noodle in Indonesia.
            images:
              - fileName: 'path-to-image.png'
                path: 'https://photo.com/path-to-image.png'
            categories:
              - _id: 507f1f77bcf86cd799439011
                name: food
            price: 3000
            netto: 80.00
            unit:
              _id: 507f1f77bcf86cd799439011
              name: gram
              abbreviation: g
            pricePerUnit: 37.50
            store:
              name: Indomaret Nglegok
              address: Jl. Raya Penataran, Nglegok 1, Nglegok, Kec. Nglegok, Kabupaten Blitar, Jawa Timur
    EditProductInput:
      allOf:
        - $ref: '#/components/schemas/ProductInputBase'
        - example:
            name: Indomie Goreng
            description: The best instant fried noodle in Indonesia.
            images:
              - fileName: 'path-to-image.png'
                path: 'https://photo.com/path-to-image.png'
            categories:
              - food
            price: 3000
            netto: 80.00
            unit:
              _id: 507f1f77bcf86cd799439011
              name: gram
              abbreviation: g
            pricePerUnit: 37.50
            store:
              name: Indomaret Nglegok
              address: Jl. Raya Penataran, Nglegok 1, Nglegok, Kec. Nglegok, Kabupaten Blitar, Jawa Timur
    ProductListWithPageResponse:
      allOf:
        - $ref: '#/components/schemas/PaginatedResponse'
        - type: object
          properties:
            docs:
              type: array
              items:
                $ref: '#/components/schemas/Product'

    ### ======================== Note ======================== ###

    Note:
      type: object
      properties:
        _id:
          type: string
        title:
          type: string
        description:
          type: string
        products:
          type: array
          items:
            type: object
            properties:
              product:
                $ref: '#/components/schemas/Product'
              amount:
                type: integer
        price:
          type: number
          format: float
        author:
          $ref: '#/components/schemas/User'
        createdAt:
          type: string
          format: date-time
      example:
        _id: 507f1f77bcf86cd799439011
        title: Saturday Night
        description: >
          The boys are coming to visit tonight. It would be nice to cook them a good
          pasta with Parmesan cheese.
        products:
          - product:
              _id: 507f1f77bcf86cd799439011
              name: La Fonte Spaghetti 450gr Pasta
              description: La Fonte Spaghetti 450gr Pasta
              images:
                - publicId: public_id
                  url: https://photo.com/path-to-image.png
              categories:
                - _id: 507f1f77bcf86cd799439011
                  name: food
              price: 17500
              netto: 450.00
              unit:
                _id: 507f1f77bcf86cd799439011
                name: gram
                abbreviation: g
              pricePerUnit: 38.89
              store:
                _id: 507f1f77bcf86cd799439011
                name: Indomaret Nglegok
                address: Jl. Raya Penataran, Nglegok 1, Nglegok, Kec. Nglegok, Kabupaten Blitar, Jawa Timur
              pinned: true,
              author:
                username: 'JohnDoe'
              createdAt: 2025-09-12T03:57:00.600Z
            amount: 2
          - product:
              _id: 507f1f77bcf86cd799439012
              name: Del Monte Spaghetti Sauce 330GR
              description: Del Monte Spaghetti Sauce 330GR
              images:
                - publicId: public_id
                  url: https://photo.com/path-to-image.png
              categories:
                - _id: 507f1f77bcf86cd799439011
                  name: food
                - _id: 507f1f77bcf86cd799439012
                  name: sauce
              price: 27250
              netto: 330.00
              unit:
                _id: 507f1f77bcf86cd799439011
                name: gram
                abbreviation: g
              pricePerUnit: 82.58
              store:
                _id: 507f1f77bcf86cd799439011
                name: Indomaret Nglegok
                address: Jl. Raya Penataran, Nglegok 1, Nglegok, Kec. Nglegok, Kabupaten Blitar, Jawa Timur
              pinned: true,
              author:
                username: 'JohnDoe'
              createdAt: 2025-09-12T03:57:00.600Z
            amount: 3
          - product:
              _id: 507f1f77bcf86cd799439013
              name: Keju Parmesan NZ Anchor 800GR
              description: Keju Parmesan NZ Anchor 800GR
              images:
                - publicId: public_id
                  url: https://photo.com/path-to-image.png
              categories:
                - _id: 507f1f77bcf86cd799439011
                  name: food
                - _id: 507f1f77bcf86cd799439013
                  name: cheese
              price: 297990
              netto: 800.00
              unit:
                _id: 507f1f77bcf86cd799439011
                name: gram
                abbreviation: g
              pricePerUnit: 372.49
              store:
                _id: 507f1f77bcf86cd799439011
                name: Indomaret Nglegok
                address: Jl. Raya Penataran, Nglegok 1, Nglegok, Kec. Nglegok, Kabupaten Blitar, Jawa Timur
              pinned: true,
              author:
                username: 'JohnDoe'
              createdAt: 2025-09-12T03:57:00.600Z
            amount: 1
        price: 414740
        author:
          _id: 507f1f77bcf86cd799439011
          username: JohnDoe
        createdAt: 2025-09-13T03:57:00.600Z
    NoteListWithPageResponse:
      allOf:
        - $ref: '#/components/schemas/PaginatedResponse'
        - type: object
          properties:
            docs:
              type: array
              items:
                $ref: '#/components/schemas/Note'

    ### ======================== User ======================== ###

    User:
      type: object
      properties:
        _id:
          type: string
          readOnly: true
        email:
          type: string
          format: email
        username:
          type: string
        hash:
          type: string
          writeOnly: true
        salt:
          type: string
          writeOnly: true
        categories:
          $ref: '#/components/schemas/Categories'
        units:
          $ref: '#/components/schemas/Units'
        stores:
          $ref: '#/components/schemas/Stores'
      example:
        _id: 507f1f77bcf86cd799439011
        email: johndoe@mail.com
        username: JohnDoe
        hash: hash_result
        salt: salt_result
        categories:
          - _id: 507f1f77bcf86cd799439011
            name: food
          - _id: 507f1f77bcf86cd799439012
            name: beverage
        units:
        stores:
          - _id: 507f1f77bcf86cd799439011
            name: Indomaret Nglegok
            address: Jl. Raya Penataran, Nglegok 1, Nglegok, Kec. Nglegok, Kabupaten Blitar, Jawa Timur
    UserRegisterInput:
      type: object
      properties:
        email:
          type: string
          format: email
        username:
          type: string
        password:
          type: string
        passwordRepeat:
          type: string
      example:
        email: johndoe@mail.com
        username: JohnDoe
        password: account_password
        passwordRepeat: account_password
    UserLoginInput:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
      example:
        username: JohnDoe
        password: account_password`

    ### ======================== General ======================== ###

    Image:
      type: object
      properties:
        publicId:
          type: string
        url:
          type: string
      example:
        publicId: public_id
        url: https://photo.com/path-to-image.png
    Categories:
      type: array
      description: An array of product category tags.
      uniqueItems: true
      items:
        $ref: '#/components/schemas/Category'
      example:
        - _id: 507f1f77bcf86cd799439011
          name: food
        - _id: 507f1f77bcf86cd799439012
          name: beverage
    Category:
      type: object
      properties:
        _id:
          type: string
        name:
          type: string
      example:
        _id: 507f1f77bcf86cd799439011
        name: food
    Units:
      type: array
      description: An array of product measuring units.
      minItems: 1
      uniqueItems: true
      items:
        $ref: '#/components/schemas/Unit'
      example:
        - _id: 507f1f77bcf86cd799439011
          name: gram
          abbreviation: g
        - _id: 507f1f77bcf86cd799439012
          name: liter
          abbreviation: l
    Unit:
      type: object
      description: The default list of measuring units.
      properties:
        _id:
          type: string
        name:
          type: string
      example:
        _id: 507f1f77bcf86cd799439011
        name: gram
        abbreviation: g
    UnitInput:
      type: object
      properties:
        name:
          type: string
        abbreviation:
          type: string
      example:
        name: gram
        abbreviation: g
    Store:
      type: object
      properties:
        _id:
          type: string
        name:
          type: string
        address:
          type: string
      example:
        _id: 507f1f77bcf86cd799439011
        name: Indomaret Nglegok
        address: Jl. Raya Penataran, Nglegok 1, Nglegok, Kec. Nglegok, Kabupaten Blitar, Jawa Timur
    Stores:
      type: array
      items:
        $ref: '#/components/schemas/Store'
    StoreInput:
      type: object
      properties:
        name:
          type: string
        address:
          type: string
      example:
        name: Indomaret Nglegok
        address: Jl. Raya Penataran, Nglegok 1, Nglegok, Kec. Nglegok, Kabupaten Blitar, Jawa Timur
    Page:
      type: integer
      minimum: 1
      default: 1
      example: 1
    Limit:
      type: integer
      enum:
        - 10
        - 25
        - 50
      default: 10
      example: 10
    PaginatedResponse:
      type: object
      properties:
        docs:
          type: array
        page:
          $ref: '#/components/schemas/Page'
        limit:
          $ref: '#/components/schemas/Limit'
        totalDocs:
          type: integer
          example: 120
    ResponseStatus:
      type: string
      enum:
        - ok
        - error
      default: ok

  parameters:
    pageParam:
      name: page
      in: query
      description: The current page for the requested data list.
      schema:
        $ref: '#/components/schemas/Page'
      required: true
    limitParam:
      name: limit
      in: query
      description: The amount of data per page.
      schema:
        $ref: '#/components/schemas/Limit'
    sortParam:
      name: sort
      in: query
      description: Sort key of an item list.
      schema:
        type: string
        enum:
          - createdAt
          - -createdAt
        default: -createdAt
    idParam:
      name: id
      in: path
      description: ID parameter for a specific data.
      schema:
        type: string
        example: 507f1f77bcf86cd799439011
      required: true
